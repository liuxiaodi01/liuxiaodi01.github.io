---
title: config.yaml配置
date: 2023-02-23 17:15:01
permalink: /pages/ea8999/
categories:
  - 后端
  - NestJS
tags:
  - 
---

# Nestjs设置dev和prod环境区分
## frist
```js
npm i --save @nestjs/config // 默认使用的包为 dotenv
npm i js-yaml
npm i -D @types/js-yaml
npm i cross-env
```
## two
+ src下建立config/configuration.ts 设置yaml引入文件需要
+ src下建立enum/config.enum.ts 方便管理枚举
## three
```js
 // config/configuration.ts 
 @@filename(configuration)
import { readFileSync } from 'fs';
import * as yaml from 'js-yaml';
import { join } from 'path';
import { merge } from 'lodash';
// 配置文件名称
const YAML_CONFIG_FILENAME = 'config.yaml';
const YAML_CONFIG_ENV = `config.${process.env.NODE_ENV || 'development'}.yaml`; // 这里名称与第五步对应起来
// path
const filePath = yaml.load(
  readFileSync(join(__dirname, '../../config', YAML_CONFIG_FILENAME), 'utf8'),
) as Record<string, any>;
const envPath = yaml.load(
  readFileSync(join(__dirname, '../../config', YAML_CONFIG_ENV), 'utf8'),
);
// 合并文件
const mergePath = merge(filePath, envPath);
export default () => {
  return mergePath;
};

```
## four
```js
// 在app.Module使用
 @@filename(app.Module)
import { Module } from '@nestjs/common';
import { ConfigModule } from '@nestjs/config';
import configuration from './config/configuration';
@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
      load: [configuration],
    }),
  ],
  controllers: [],
  providers: [],
})
export class AppModule {}
```
## five
```js
// 在根目录设置config/config.yaml
// 在根目录设置config/config.production 
// 在根目录设置config/config.development
@@filename(config.yaml) //config.yaml 文件内容
db:
  mysql: 'localhost:3000'
  mongoose: 'localhost:4000'
// end config.yaml
@@filename(config.development.yaml) //config.developmen.yaml 文件内容
db:
  NODE_ENV: 'development'
// end config.development.yaml
@@filename(config.production.yaml) //config.developmen.yaml 文件内容
db:
  NODE_ENV: 'production'
// end config.production.yaml
```
## last
```js
// 配置package.json环境区分
@@filename(package.json)
	"scripts":{
	 	"start:dev": "cross-env NODE_ENV=development nest start --watch",
 	 	"start:prod": "cross-env NODE_ENV=production node dist/main",
	}	  

```