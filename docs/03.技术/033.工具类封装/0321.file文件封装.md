---
title: file文件封装
date: 2023-02-23 18:24:18
permalink: /pages/b58d10/
categories:
  - 技术
  - 工具类封装
tags:
  - 
---

## 单文件上传
```js
//上传单个文件
	export function uploadFile(callback: any, data?: object) {
	  var fileDom = document.createElement("input") as any;
	  fileDom.setAttribute("type", "file");
	  fileDom.addEventListener("change", (files: any) => {
	    callback && callback(fileDom.files[0], data);
	  });
	  fileDom.click();
	}
    // 调用 uploadFileJson() 就ok了
```
##  json文件解析
```js
  	export  function uploadFileJson(file) {
      uploadFile((file: File) => {
        if (file.type === "application/json") {
          const reader = new FileReader();
          reader.readAsText(file, "utf-8"); //发起异步请求
          reader.onload = function (readRes: any) {
            const readJson = JSON.parse(readRes.target.result);
            return readJson
          };
        } else {
          message.error("上传格式不正确,请上传json文件");
        }
      });
    }
```

## 下载并指点文件
```js
export function saveAsJSON(data, type ,filename) {
  if (!data) {
    console.error("No data");
    return;
  }
  if (!filename) filename = "console.json";
  if (typeof data === "object") {
    data = JSON.stringify(data, undefined, 4);
  }
  var blob = new Blob([data], { type }),
    e = document.createEvent("MouseEvents"),
    a = document.createElement("a");
  a.download = filename;
  a.href = window.URL.createObjectURL(blob);
  a.dataset.downloadurl = ["text/json", a.download, a.href].join(":");
  e.initEvent("click", true, false);
  a.dispatchEvent(e);
}

```